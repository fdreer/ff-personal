---
import Layout from '@/layouts/Layout.astro'
---

<Layout title="FF Franco">
    <main>
        <form action="" id="form">
            <label for="concept">
                Concepto de compra
                <input type="text" name="concept" id="concept" />
            </label>

            <label for="calendar">
                Fecha
                <br />
                <input type="date" name="shoppingDate" id="calendar" />
            </label>

            <label for="total">
                Importe
                <input type="tel" name="totalAmount" id="total" />
            </label>

            <label for="quotas">
                NÂº de cuotas
                <input type="tel" name="quotas" id="quotas" />
            </label>

            <button type="submit" class="send-btn">REGISTRAR</button>
            <button type="reset" class="reset-btn">CARGAR NUEVO</button>
        </form>
    </main>
</Layout>

<script>
    import { $ } from '@/lib/dom-selector'

    const $form = $('#form') as HTMLFormElement
    const $conceptInput = $('#concept') as HTMLInputElement
    const $resetBtn = $('.reset-btn') as HTMLButtonElement

    const handleSubmit = async (e: SubmitEvent) => {
        e.preventDefault()

        const formData = new FormData(e.target as HTMLFormElement)

        const res = await fetch('/api/purchase', {
            method: 'POST',
            body: formData
        })

        if (!res.ok) {
            console.log('Error')
            return
        }

        $form.reset()
        $conceptInput.focus()
    }

    $form.addEventListener('submit', handleSubmit)
    $resetBtn.addEventListener('click', () => {
        $('#concept')?.focus()
    })
</script>

<style>
    form {
        display: flex;
        flex-direction: column;
        gap: 20px;
        max-width: 380px;
        margin: 0 auto;
        font-size: 1.3rem;
        font-weight: 500;
    }

    input {
        border: none;
        border-radius: 4px;

        width: 100%;
        padding: 10px;
    }

    button {
        border: none;
        border-radius: 4px;

        padding: 10px;
        cursor: pointer;
    }

    .send-btn {
        background-color: #3dc763;
    }

    .reset-btn {
        background-color: #478aef;
    }

    .load {
        display: flex;
        justify-content: center;
    }

    .res-msg {
        font-size: 1.5rem;
        font-weight: 500;
    }

    .error {
        color: rgb(226, 38, 77);
        text-decoration: underline;
    }
</style>
